<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title></title>
	</head>

	<body>
<textarea id="op" rows="100" cols="100"></textarea>
		<script type="text/javascript">
		var 		_protoPropNames = ["this", "propertyIsEnumerable", "isPrototypeOf", "hasOwnProperty", "toLocaleString", "toString", "valueOf", "constructor"];
		
		function StringBuffer(){
				this.buf = [];
				this.append = function(str){
					this.buf.push(str);
				}
				
				this.toString = function(){
					return this.buf.join("");
				}
			}
			var getterCache = {};
			var setterCache = {};

			function createGetterExpr(expr) {
				if (!getterCache.hasOwnProperty(expr)) {
					var funBody = "var $$$rsl = $$$obj." + expr + ";return $$$rsl;"
					var fun = new Function("$$$obj", funBody);
					getterCache[expr] = fun;
				}
				return getterCache[expr];
			}

			function createSetterExpr(expr) {
				if (!setterCache.hasOwnProperty(expr)) {
					var funBody = "$$$obj." + expr + "=$$$val;return;"
					var fun = new Function("$$$obj", "$$$val", funBody);
					setterCache[expr] = fun;
				}
				return setterCache[expr];
			}

			function doGet(expr, owner) {
				return createGetterExpr(expr).call(owner,owner)
			}
			function doSet(expr, owner, val) {
				createSetterExpr(expr).call(owner,owner,val)
			}
			String.prototype.endWith=function(str){
				if(str==null||str==""||this.length==0||str.length>this.length)
				  return false;
				if(this.substring(this.length-str.length)==str)
				  return true;
				else
				  return false;
				return true;
			}
			if (!Array.prototype.indexOf) {
				Array.prototype.indexOf = function(item, index) {
					var n = this.length,
						i = ~~index
					if (i < 0)
						i += n
					for (; i < n; i++)
						if (this[i] === item)
							return i
					return -1
				}
			}
		</script>

		<script type="text/vbscript">
			Function appendExpr(expr, prop)
				if expr="" then
				 appendExpr = prop
				else
				 appendExpr = expr & "." & prop
				end if
			End Function
			
			Class Class_A 
				Public expr 
				Public owner
				Public Property get a 
					 a = doGet (appendExpr(expr,"a"), owner)
					 
				End Property 
				Public Property Let a(c) 
					call doset (appendExpr(expr,"a"), owner, c ) 
				End Property 
				
			End Class
			
			Sub funcX(callback)
			    Set objC = new Class_A 
			    callback(objC)
			End Sub
			
		</script>
		<script type="text/javascript">
		
		var obj = {};
		
		var owner = {a:"123",
				c:"123"}
		
		
		function callBackFun (obj,expr, owner){
			return function(o){
				obj.target = o;
				obj.target.expr = expr
				obj.target.owner = owner;
			}
		}
		
		var rtnFun = callBackFun(obj,"", owner);
		funcX(rtnFun );
		var pupet = obj.target
		alert(pupet.a)


		function definePuppet(obj, expr){
			var sb = new StringBuffer();
			var clsid = "Class_"+setTimeout("1");
			//sb.append("
			sb.append("Class " + clsid);
			sb.append("\nPublic expr__");
			sb.append("\nPublic owner__");
			
				
				
				for (var eleId in obj) {
					debugger;
					if (!eleId.endWith("__")   && _protoPropNames.indexOf(eleId) == -1) {
						sb.append("\nPublic Property get " + eleId);
						sb.append("\n" + eleId + "= doGet (appendExpr(expr__,\""+ eleId +"\"), owner__)\nEnd Property ");
					
						sb.append("\nPublic Property Let " + eleId +"(c__)");
						sb.append("\n call doset (appendExpr(expr__,\""+ eleId +"\"), owner__,c__)\nEnd Property ");

						sb.append("\nPublic Property Set " + eleId +"(c__)");
						sb.append("\n call doset (appendExpr(expr__,\""+ eleId +"\"), owner__,c__)\nEnd Property ");
					
					}
				}
				
			sb.append("\nEnd Class");	
			
			sb.append("\nSub funcX(callback)\nSet objC = new "+ clsid +" \ncallback(objC)\nEnd Sub");	
			
		return sb.toString();
		}

var vm = {
				text1:"123",
				object1:{foo:"123"},
				object2:{ex:"ddd",arr1:[{de:12,fa:"sd"},{de:12,fa:"sd"}]}
			}

var xx = definePuppet(vm, "");
document.getElementById("op").value = xx;
 
		</script>

	</body>

</html>